<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Ranking | Next Level Podcast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"
        rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { aec: { blue: '#0032A1', dark: '#001E4B', pink: '#ec4899', pinkDark: '#be185d' } }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 3px;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .gradient-text {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .float {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-slate-950 text-white min-h-screen font-sans">

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 bg-slate-900/90 border-b border-slate-800 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <a href="index.html" class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-aec-pink text-2xl">podcasts</span>
                    <span class="font-bold">Next <span class="gradient-text">Level</span></span>
                </a>

                <div class="flex items-center gap-4">
                    <a href="dashboard.html" class="text-slate-400 hover:text-white text-sm flex items-center gap-1">
                        <span class="material-symbols-outlined text-lg">dashboard</span>
                        Dashboard
                    </a>
                    <button onclick="logout()" class="text-slate-400 hover:text-red-400" title="Sair">
                        <span class="material-symbols-outlined">logout</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <div class="inline-block mb-4 float">
                <span class="material-symbols-outlined text-6xl text-aec-pink">leaderboard</span>
            </div>
            <h1 class="text-4xl font-black mb-2">Ranking <span class="gradient-text">Next Level</span></h1>
            <p class="text-slate-400">Os melhores analistas em forma√ß√£o</p>
        </header>

        <!-- Top 3 Podium -->
        <section id="podium" class="mb-12 hidden">
            <div class="flex items-end justify-center gap-4">
                <!-- 2nd Place -->
                <div id="second" class="text-center">
                    <div
                        class="w-24 h-24 mx-auto mb-2 bg-slate-800 rounded-full flex items-center justify-center border-4 border-slate-500">
                        <span class="text-3xl">ü•à</span>
                    </div>
                    <p class="font-bold text-sm truncate max-w-24"></p>
                    <p class="text-xs text-slate-400"></p>
                    <div class="w-24 h-20 bg-slate-800 mt-2 rounded-t-xl flex items-center justify-center">
                        <span class="text-2xl font-bold text-slate-500">2¬∫</span>
                    </div>
                </div>

                <!-- 1st Place -->
                <div id="first" class="text-center">
                    <div
                        class="w-28 h-28 mx-auto mb-2 bg-gradient-to-br from-yellow-500 to-amber-600 rounded-full flex items-center justify-center border-4 border-yellow-400 shadow-lg shadow-yellow-500/30">
                        <span class="text-4xl">üèÜ</span>
                    </div>
                    <p class="font-bold truncate max-w-28"></p>
                    <p class="text-sm text-aec-pink"></p>
                    <div
                        class="w-28 h-28 bg-gradient-to-t from-aec-pink/50 to-aec-pink/20 mt-2 rounded-t-xl flex items-center justify-center border-t-2 border-aec-pink">
                        <span class="text-3xl font-bold text-white">1¬∫</span>
                    </div>
                </div>

                <!-- 3rd Place -->
                <div id="third" class="text-center">
                    <div
                        class="w-20 h-20 mx-auto mb-2 bg-slate-800 rounded-full flex items-center justify-center border-4 border-amber-700">
                        <span class="text-2xl">ü•â</span>
                    </div>
                    <p class="font-bold text-sm truncate max-w-20"></p>
                    <p class="text-xs text-slate-400"></p>
                    <div class="w-20 h-16 bg-slate-800 mt-2 rounded-t-xl flex items-center justify-center">
                        <span class="text-xl font-bold text-amber-700">3¬∫</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Position -->
        <section id="my-position" class="hidden mb-8">
            <div class="glass-panel rounded-2xl p-6 border border-aec-pink/30">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 bg-aec-pink/20 rounded-full flex items-center justify-center">
                        <span id="my-rank" class="text-2xl font-bold text-aec-pink">#-</span>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm text-slate-400">Sua posi√ß√£o</p>
                        <p id="my-name" class="font-bold text-lg"></p>
                    </div>
                    <div class="text-right">
                        <p id="my-points" class="text-2xl font-bold text-aec-pink">0</p>
                        <p class="text-xs text-slate-500">pontos</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Full Ranking -->
        <section class="glass-panel rounded-2xl overflow-hidden">
            <div class="p-4 bg-slate-900/50 border-b border-slate-800">
                <h2 class="font-bold flex items-center gap-2">
                    <span class="material-symbols-outlined text-aec-pink">format_list_numbered</span>
                    Ranking Completo
                </h2>
            </div>

            <div id="ranking-list" class="divide-y divide-slate-800">
                <div class="text-center py-12 text-slate-500">
                    <span class="material-symbols-outlined text-4xl mb-2 animate-spin">progress_activity</span>
                    <p>Carregando ranking...</p>
                </div>
            </div>
        </section>
    </main>

    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        let currentUserId = null;

        async function init() {
            const profile = await getUserProfile();
            if (profile) {
                currentUserId = profile.id;
            }

            await loadRanking();
        }

        async function loadRanking() {
            const { data: ranking, error } = await supabaseClient
                .from('usuarios')
                .select('id, nickname, pontuacao_total')
                .eq('status', 'aprovado')
                .gt('pontuacao_total', 0)
                .order('pontuacao_total', { ascending: false });

            if (error || !ranking?.length) {
                document.getElementById('ranking-list').innerHTML = `
                    <div class="text-center py-12 text-slate-500">
                        <span class="material-symbols-outlined text-4xl mb-2">emoji_events</span>
                        <p>Nenhum usu√°rio ranqueado ainda</p>
                        <p class="text-xs mt-2">Complete provas para aparecer no ranking!</p>
                    </div>
                `;
                return;
            }

            // Render podium
            if (ranking.length >= 3) {
                document.getElementById('podium').classList.remove('hidden');

                const [first, second, third] = ranking;

                document.querySelector('#first p:first-of-type').textContent = first.nickname;
                document.querySelector('#first p:last-of-type').textContent = `${first.pontuacao_total} pts`;

                document.querySelector('#second p:first-of-type').textContent = second.nickname;
                document.querySelector('#second p:last-of-type').textContent = `${second.pontuacao_total} pts`;

                document.querySelector('#third p:first-of-type').textContent = third.nickname;
                document.querySelector('#third p:last-of-type').textContent = `${third.pontuacao_total} pts`;
            }

            // Show my position
            if (currentUserId) {
                const myIndex = ranking.findIndex(u => u.id === currentUserId);
                if (myIndex >= 0) {
                    document.getElementById('my-position').classList.remove('hidden');
                    document.getElementById('my-rank').textContent = `#${myIndex + 1}`;
                    document.getElementById('my-name').textContent = ranking[myIndex].nickname;
                    document.getElementById('my-points').textContent = ranking[myIndex].pontuacao_total;
                }
            }

            // Render full list
            const container = document.getElementById('ranking-list');
            container.innerHTML = ranking.map((user, index) => {
                const isMe = user.id === currentUserId;
                const medals = ['ü•á', 'ü•à', 'ü•â'];

                return `
                    <div class="flex items-center gap-4 p-4 ${isMe ? 'bg-aec-pink/10' : 'hover:bg-slate-800/50'} transition-colors">
                        <div class="w-10 h-10 flex items-center justify-center font-bold ${index < 3 ? 'text-2xl' : 'text-lg text-slate-500'}">
                            ${index < 3 ? medals[index] : (index + 1)}
                        </div>
                        <div class="flex-1">
                            <p class="font-medium ${isMe ? 'text-aec-pink' : ''}">${user.nickname} ${isMe ? '(voc√™)' : ''}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-aec-pink">${user.pontuacao_total}</p>
                            <p class="text-xs text-slate-500">pontos</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function logout() {
            await supabaseClient.auth.signOut();
            window.location.href = 'index.html';
        }

        init();
    </script>
</body>

</html>