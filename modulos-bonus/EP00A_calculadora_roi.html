<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de ROI de Carreira | Next Level</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/bonus-service.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>

<body class="bg-slate-950 text-white min-h-screen p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
            <a href="../bonus.html" class="text-slate-400 hover:text-white text-sm flex items-center gap-2 mb-4">
                <span class="material-symbols-outlined">arrow_back</span>
                Voltar para Módulos Bônus
            </a>
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-green-500/20 rounded-2xl flex items-center justify-center">
                    <span class="material-symbols-outlined text-green-400 text-4xl">calculate</span>
                </div>
                <div>
                    <span class="text-xs text-green-400 font-bold">T0: INTRO • NÍVEL FÁCIL</span>
                    <h1 class="text-3xl font-bold">Calculadora de ROI de Carreira</h1>
                    <p class="text-slate-400">Calcule o retorno sobre investimento da mudança de carreira</p>
                </div>
            </div>
        </div>

        <!-- Calculator -->
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-6">Dados da Carreira</h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-2">Salário Atual (Atendente)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500">R$</span>
                            <input type="number" id="salario-atual" value="2000"
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg px-10 py-3 text-white focus:border-green-500 outline-none"
                                oninput="calcularROI()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-slate-400 mb-2">Salário Desejado (Analista)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500">R$</span>
                            <input type="number" id="salario-desejado" value="5000"
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg px-10 py-3 text-white focus:border-green-500 outline-none"
                                oninput="calcularROI()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-slate-400 mb-2">Investimento em Estudos/Cursos</label>
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500">R$</span>
                            <input type="number" id="investimento" value="3000"
                                class="w-full bg-slate-900 border border-slate-700 rounded-lg px-10 py-3 text-white focus:border-green-500 outline-none"
                                oninput="calcularROI()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-slate-400 mb-2">Tempo Estimado de Transição (meses)</label>
                        <input type="range" id="tempo-transicao" min="3" max="24" value="6" class="w-full"
                            oninput="calcularROI(); document.getElementById('tempo-valor').textContent = this.value">
                        <div class="flex justify-between text-xs text-slate-500 mt-1">
                            <span>3 meses</span>
                            <span id="tempo-valor" class="text-green-400 font-bold">6 meses</span>
                            <span>24 meses</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="glass-panel rounded-2xl p-6">
                <h2 class="text-xl font-bold mb-6">Análise de ROI</h2>

                <div class="space-y-4">
                    <div class="bg-slate-900/50 rounded-lg p-4">
                        <p class="text-xs text-slate-400 mb-1">Aumento Mensal</p>
                        <p id="aumento-mensal" class="text-2xl font-bold text-green-400">R$ 3.000</p>
                    </div>

                    <div class="bg-slate-900/50 rounded-lg p-4">
                        <p class="text-xs text-slate-400 mb-1">Ganho Anual</p>
                        <p id="ganho-anual" class="text-2xl font-bold text-green-400">R$ 36.000</p>
                    </div>

                    <div class="bg-slate-900/50 rounded-lg p-4">
                        <p class="text-xs text-slate-400 mb-1">Retorno do Investimento (ROI)</p>
                        <p id="roi"
                            class="text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-500 bg-clip-text text-transparent">
                            +1.100%</p>
                        <p class="text-xs text-slate-500 mt-1">Recuperará o investimento em <span id="payback"
                                class="text-green-400 font-bold">1 mês</span></p>
                    </div>

                    <div class="bg-slate-900/50 rounded-lg p-4">
                        <p class="text-xs text-slate-400 mb-1">Ganho Total em 5 anos</p>
                        <p id="ganho-5anos" class="text-2xl font-bold text-green-400">R$ 180.000</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="glass-panel rounded-2xl p-6 mt-8">
            <h2 class="text-xl font-bold mb-6">Projeção de Ganhos nos Próximos 5 Anos</h2>
            <canvas id="roiChart" height="80"></canvas>
        </div>

        <div class="mt-8 text-center">
            <button onclick="completarModulo()"
                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-green-500/50 transition-all hover:scale-105">
                ✅ CONCLUIR MÓDULO (+5 PONTOS)
            </button>
        </div>
    </div>

    <script>
        let chart = null;

        function calcularROI() {
            const salarioAtual = parseFloat(document.getElementById('salario-atual').value) || 0;
            const salarioDesejado = parseFloat(document.getElementById('salario-desejado').value) || 0;
            const investimento = parseFloat(document.getElementById('investimento').value) || 0;
            const tempoTransicao = parseInt(document.getElementById('tempo-transicao').value) || 6;

            const aumentoMensal = salarioDesejado - salarioAtual;
            const ganhoAnual = aumentoMensal * 12;
            const roi = ((ganhoAnual - investimento) / investimento * 100).toFixed(0);
            const payback = investimento > 0 ? Math.ceil(investimento / aumentoMensal) : 0;
            const ganho5Anos = ganhoAnual * 5 - investimento;

            document.getElementById('aumento-mensal').textContent = `R$ ${aumentoMensal.toLocaleString('pt-BR')}`;
            document.getElementById('ganho-anual').textContent = `R$ ${ganhoAnual.toLocaleString('pt-BR')}`;
            document.getElementById('roi').textContent = `+${roi}%`;
            document.getElementById('payback').textContent = `${payback} ${payback === 1 ? 'mês' : 'meses'}`;
            document.getElementById('ganho-5anos').textContent = `R$ ${ganho5Anos.toLocaleString('pt-BR')}`;

            atualizarGrafico(salarioAtual, salarioDesejado, tempoTransicao);
        }

        function atualizarGrafico(salarioAtual, salarioDesejado, tempoTransicao) {
            const labels = [];
            const dataAtual = [];
            const dataDesejado = [];

            for (let i = 0; i <= 60; i += 6) {
                labels.push(`${i} meses`);
                dataAtual.push((salarioAtual * 12 * (i / 12)).toFixed(0));

                if (i < tempoTransicao) {
                    dataDesejado.push((salarioAtual * 12 * (i / 12)).toFixed(0));
                } else {
                    const mesesComoAnalista = i - tempoTransicao;
                    const ganhoTotal = (salarioAtual * 12 * (tempoTransicao / 12)) + (salarioDesejado * 12 * (mesesComoAnalista / 12));
                    dataDesejado.push(ganhoTotal.toFixed(0));
                }
            }

            if (chart) chart.destroy();

            const ctx = document.getElementById('roiChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Permanecendo Atendente',
                            data: dataAtual,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Virando Analista de Qualidade',
                            data: dataDesejado,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: '#94a3b8' }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: '#94a3b8',
                                callback: value => `R$ ${(value / 1000).toFixed(0)}k`
                            },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(148, 163, 184, 0.1)' }
                        }
                    }
                }
            });
        }

        async async function completarModulo() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = '⏳ Salvando...';

            try {
                const resultado = await BonusService.completarModulo('EP00A_ROI', 'facil');

                if (resultado.success) {
                    alert(resultado.message);
                    window.location.href = '../bonus.html';
                } else {
                    alert(resultado.message);
                    btn.disabled = false;
                    btn.textContent = '✅ CONCLUIR MÓDULO (+5 PONTOS)';
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('❌ Erro ao salvar progresso. Tente novamente.');
                btn.disabled = false;
                btn.textContent = '✅ CONCLUIR MÓDULO (+5 PONTOS)';
            }
        } else {
                    alert(resultado.message);
                    btn.disabled = false;
                    btn.textContent = '✅ CONCLUIR MÓDULO (+5 PONTOS)';
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('❌ Erro ao salvar progresso. Tente novamente.');
                btn.disabled = false;
                btn.textContent = '✅ CONCLUIR MÓDULO (+5 PONTOS)';
            }
        }

        // Inicializar
        calcularROI();
    </script>
</body>

</html>