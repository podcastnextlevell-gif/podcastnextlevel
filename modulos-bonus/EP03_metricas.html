<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de M√©tricas | Next Level</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>

<body class="bg-slate-950 text-white min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <div class="mb-8">
            <a href="../bonus.html" class="text-slate-400 hover:text-white text-sm flex items-center gap-2 mb-4">
                <span class="material-symbols-outlined">arrow_back</span>
                Voltar
            </a>
            <h1 class="text-3xl font-bold">üìä Dashboard de Correla√ß√£o de M√©tricas</h1>
        </div>

        <!-- Level Selection -->
        <div id="level-selection" class="glass-panel rounded-2xl p-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <button onclick="startLevel('facil')"
                    class="bg-green-500/20 border-2 border-green-500/50 rounded-xl p-6">
                    <span class="text-green-400 font-bold">‚≠ê F√ÅCIL (5 pts)</span>
                    <p class="text-sm mt-2">Otimize 2 m√©tricas b√°sicas</p>
                </button>
                <button onclick="startLevel('intermediario')"
                    class="bg-orange-500/20 border-2 border-orange-500/50 rounded-xl p-6">
                    <span class="text-orange-400 font-bold">‚≠ê‚≠ê INTERMEDI√ÅRIO (10 pts)</span>
                    <p class="text-sm mt-2">Balanceie 4 m√©tricas correlacionadas</p>
                </button>
                <button onclick="startLevel('dificil')" class="bg-red-500/20 border-2 border-red-500/50 rounded-xl p-6">
                    <span class="text-red-400 font-bold">‚≠ê‚≠ê‚≠ê DIF√çCIL (20 pts)</span>
                    <p class="text-sm mt-2">Otimize 6 m√©tricas + indicadores financeiros</p>
                </button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="game-area" class="hidden">
            <div class="glass-panel rounded-2xl p-6 mb-6">
                <h3 class="text-lg font-bold mb-4">üéØ Objetivo: <span id="goal"></span></h3>
                <div id="controls-area" class="space-y-4"></div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div class="glass-panel rounded-2xl p-6">
                    <h3 class="text-lg font-bold mb-4">üìà Resultados</h3>
                    <div id="results" class="space-y-3"></div>
                </div>
                <div class="glass-panel rounded-2xl p-6">
                    <h3 class="text-lg font-bold mb-4">üí∞ Impacto Financeiro</h3>
                    <div class="text-4xl font-bold mb-2">R$ <span id="revenue">0</span></div>
                    <div class="text-sm text-slate-400">Receita Mensal Estimada</div>
                </div>
            </div>

            <div class="text-center">
                <button onclick="validate()"
                    class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-8 py-4 rounded-xl font-bold text-lg">
                    ‚úÖ VALIDAR OTIMIZA√á√ÉO
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentLevel = null;
        let metrics = {};
        let targets = {};

        const levels = {
            facil: {
                goal: "TMA < 180s e FCR > 80%",
                metrics: { tma: 240, fcr: 65 },
                targets: { tma: 180, fcr: 80 },
                labels: { tma: "TMA (segundos)", fcr: "FCR (%)" },
                ranges: { tma: [60, 360], fcr: [50, 95] }
            },
            intermediario: {
                goal: "TMA < 150s, FCR > 85%, NPS > 70, CSAT > 4.5",
                metrics: { tma: 200, fcr: 70, nps: 55, csat: 3.8 },
                targets: { tma: 150, fcr: 85, nps: 70, csat: 4.5 },
                labels: { tma: "TMA (s)", fcr: "FCR (%)", nps: "NPS", csat: "CSAT" },
                ranges: { tma: [60, 300], fcr: [50, 95], nps: [0, 100], csat: [1, 5] }
            },
            dificil: {
                goal: "Todas m√©tricas no target + Receita > R$ 500k",
                metrics: { tma: 180, fcr: 75, nps: 60, csat: 4.0, ces: 3.5, churn: 8 },
                targets: { tma: 120, fcr: 90, nps: 80, csat: 4.7, ces: 2.0, churn: 3 },
                labels: { tma: "TMA", fcr: "FCR %", nps: "NPS", csat: "CSAT", ces: "CES", churn: "Churn %" },
                ranges: { tma: [60, 240], fcr: [60, 95], nps: [40, 100], csat: [1, 5], ces: [1, 5], churn: [1, 15] }
            }
        };

        function startLevel(level) {
            currentLevel = level;
            const config = levels[level];
            metrics = { ...config.metrics };
            targets = config.targets;

            document.getElementById('level-selection').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
            document.getElementById('goal').textContent = config.goal;

            renderControls(config);
            updateResults();
        }

        function renderControls(config) {
            const area = document.getElementById('controls-area');
            area.innerHTML = Object.keys(metrics).map(key => {
                const range = config.ranges[key];
                return `
                    <div>
                        <label class="block text-sm font-medium mb-2">${config.labels[key]}</label>
                        <div class="flex items-center gap-4">
                            <input type="range" id="${key}" min="${range[0]}" max="${range[1]}" value="${metrics[key]}" step="1"
                                class="flex-1" oninput="updateMetric('${key}', this.value)">
                            <span id="${key}-value" class="text-lg font-bold w-16">${metrics[key]}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMetric(key, value) {
            metrics[key] = parseFloat(value);
            document.getElementById(`${key}-value`).textContent = value;
            updateResults();
        }

        function updateResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = Object.keys(metrics).map(key => {
                const current = metrics[key];
                const target = targets[key];
                const achieved = (key === 'tma' || key === 'churn' || key === 'ces') ? current <= target : current >= target;
                const color = achieved ? 'text-green-400' : 'text-red-400';

                return `
                    <div class="flex justify-between">
                        <span>${levels[currentLevel].labels[key]}:</span>
                        <span class="${color} font-bold">${current} ${achieved ? '‚úì' : '‚úó'}</span>
                    </div>
                `;
            }).join('');

            // Calculate revenue
            const baseRevenue = 100000;
            const multiplier = Object.keys(metrics).reduce((acc, key) => {
                const current = metrics[key];
                const target = targets[key];
                const achieved = (key === 'tma' || key === 'churn' || key === 'ces') ? current <= target : current >= target;
                return acc * (achieved ? 1.2 : 0.9);
            }, 1);

            document.getElementById('revenue').textContent = Math.round(baseRevenue * multiplier).toLocaleString('pt-BR');
        }

        function validate() {
            const allAchieved = Object.keys(metrics).every(key => {
                const current = metrics[key];
                const target = targets[key];
                return (key === 'tma' || key === 'churn' || key === 'ces') ? current <= target : current >= target;
            });

            const points = currentLevel === 'facil' ? 5 : currentLevel === 'intermediario' ? 10 : 200;

            if (allAchieved) {
                alert(`üéâ Parab√©ns! Todas as m√©tricas otimizadas!\n\n+${points} pontos!`);
                window.location.href = '../bonus.html';
            } else {
                alert('‚ö†Ô∏è Ainda h√° m√©tricas fora do target. Continue ajustando!');
            }
        }
    </script>
</body>

</html>
